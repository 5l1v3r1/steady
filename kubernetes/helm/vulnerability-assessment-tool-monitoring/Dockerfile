FROM alpine:3.10.2

ARG STERN_VERSION="1.11.0"
ENV STERN_VERSION=${STERN_VERSION}

ARG WRAPPER_DIR="/vulas/stern"
ENV WRAPPER_DIR=${WRAPPER_DIR}

ARG VULAS_CORE_NAMESPACE="vulnerability-assessment-tool-core"
ENV VULAS_CORE_NAMESPACE=${VULAS_CORE_NAMESPACE}

ARG VULAS_ADMIN_NAMESPACE="vulnerability-assessment-tool-admin"
ENV VULAS_ADMIN_NAMESPACE=${VULAS_ADMIN_NAMESPACE}

ARG VULAS_MONITORING_NAMESPACE="vulnerability-assessment-tool-monitoring"
ENV VULAS_MONITORING_NAMESPACE=${VULAS_MONITORING_NAMESPACE}

WORKDIR $WRAPPER_DIR
COPY ./install.sh install.sh
COPY ./stern.sh stern.sh

RUN chmod +x install.sh \
    && echo 'alias stern.sh="sh /usr/local/bin/stern.sh"' > /etc/profile.d/aliases.sh

RUN ["./install.sh"]

# Launch command: docker run -ti -v ~/.kube/config:/root/.kube/config vulas-stern:v0.0.1 sh -l
